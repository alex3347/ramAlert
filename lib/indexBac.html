<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>EOS内存价格趋势 | TokenPocket - 你的通用数字钱包</title>
    <style>
        i{
            font-style: normal;
        }
        h5 {
            color: #aaa;
        }

        html, body {
            margin: 0;
            padding: 0;
            background-color: #161619;
            color: #EEE;
        }

        html {
            position: relative;
        }
        body{
            padding-top: 40px;
        }
        p {
            font-size: 14px;
            margin: 8px 0;
        }

        h2 {
            text-align: center;
            font-size: 18px;
            margin: 20px 0 0;
        }


        .from {
            cursor: pointer;
            display: inline-block;
            padding: 5px 0;
            color: #ddd;
        }

        input:checked + label {
            border: 1px solid #eee;
        }


        .progress p {
            padding: 0;
            margin: 0 0 10px;
            -webkit-transition: all 0.2s ease 0s;
            transition: all 0.2s ease 0s;
            position: relative;
            line-height: 1.5;
        }


        #eos-price {
            position: relative;
            font-size: 18px;
            margin-top: 8px;
        }

        #real-time-price {
            font-size: 24px;
        }

        #big-account,
        #account {
            height: 28px;
            line-height: 28px;
            vertical-align: middle;
            border-radius: 2px;
            -webkit-appearance: none;
            padding-left: 10px;
            border-width: 1px;
        }

        .from-buy,
        .buy {
            color: #ef4b35;
        }

        .from-sell,
        .sell {
            color: #06a94b;
        }

        hr {
            margin: 10px auto;
            border: none;
            border-top: 1px solid #666;
        }

        .bigone, 
        .trade-history,
        .big-one {
            width: 100%;
            display: inline-block;
            box-sizing: border-box;
            text-align: center;
            float: left;
            padding-bottom: 20px;
        }

        .query-bar {
            text-align: center;
        }

        #big-query-btn,
        #big-clear-btn,
        #query-btn,
        #clear-btn {
            height: 28px;
            color: #fff;
            border: 1px solid #ddd;
            border-radius: 2px;
            background: transparent;
            margin-left: 5px;
        }

        .big-list,
        .bigone-list,
        .trade-list {
            font-family: Consolas, Monaco, monospace;
            list-style: none;
            font-size: 12px;
            padding: 0;
            padding: 0;
            text-align: left;
            margin: 0 auto;
            width: 100%;
            max-width: 500px;
        }

        /* .bigone-list {
            max-width: 500px;
        } */

        .big-list li,
        .trade-list li,
        .bigone-list li {
            padding: 0 12px;
            /* border-top: 1px solid #0f1118; */
            color: #999eb1;
            position: relative;
            overflow: hidden;
        }

        .bigone-list li {
            border-top: 1px solid #171923;
            padding: 8px 20px;
            color: #eee;
        }

        .bigone-list li:nth-child(even) {
            background: #2a2b3a
        }


        .clearfix {
            clear: both;
        }

        .refresh {
            position: absolute;
            right: 15px;
            top: 3px;
            cursor: pointer;
            display: block;
            color: #ddd;
            padding: 2px 5px;
            font-size: 12px;
            border: 1px solid #666;
        }

        .empty-li {
            text-align: center;
        }
        .real-time-normal {
            color: #f79816;
        }
        .real-time {
            color: #f79816;
            animation: realtime 0.5s ease 0s 1 alternate;
        }

        .time,
        .from,
        .buy,
        .sell {
            float: left;
            padding: 4px 0;
        }

        .time {
            display: inline-block;
            width: 34%;
        }
        .from {
            width: 29%;
            text-decoration: underline;
        }
        .buy,
        .sell {
            display: inline-block;
            /* margin-left: 5%; */
            width: 37%;
        }

        .rank,
        .big-account,
        .volume,
        .percent {
            display: inline-block;
            float: left;
        }

        .rank {
            width: 10%;
        }
        .big-account {
            color: #fff;
            width: 40%;
            text-align: center;
            text-decoration: underline;
        }
        .volume {
            width: 30%;
            text-align: right;
        }
        .percent {
            width: 20%;
            text-align: right;
        }

        @keyframes realtime
        {
            /* 0% {text-shadow: 0 0 0 #fff;}
            80% {text-shadow: 1px 1px 10px #fff;}
            100% {text-shadow: 0 0 0 #fff;} */

            0% {color: #fff; text-shadow: 1px 1px 10px #fff;}
            100% {color: #f79816; text-shadow: 0 0 0 #fff;}
        }

        @media screen and (min-width: 1024px) {

            .bigone, 
            .trade-history
            {
                width: 36%;
            }
            .big-one {
                width: 28%;
            }

            .big-list,
            .trade-list,
            .bigone-list {
                font-size: 14px;
            }

            .statics {
                width: 100%;
            }
        }

        @media screen and (max-width: 321px) {
            .bigone, .trade-history {
                padding-left: 0;
            }
            
            .big-list li, .trade-list li {
                padding: 4px;
            }
     

            .from,
            .buy,
            .sell {
                margin-left: 0;
            }
        }
        .postion-center{
            text-align: center;
            font-size: 18px;
        }
        .input-container{
            font-size: 18px;
            margin-top: 4px;
        }
        .ram-info,.eos-info{
            margin-top: 40px;
        }
        .ram-info-container{
            text-align: center;
            padding-top: 8px;
        }
        .ram-info-container>div{
            display: inline-block;
        }
        .ram-info-container .left{
            margin-right: 14px;
        }
        .alert{
            color: #f70606;
            animation: realtime 0.5s ease 0s 1 alternate;
        }
    </style>
</head>
<body>
    <div class="postion-center">
        实时价格 <span id="real-time-price"></span> EOS/KB
    </div>
    <div class="input-container postion-center" id="lowPriceContainer">
        <span>低于价格</span>
        <input type="text" placeholder="输入价格" id="lowPrice">
        <span>预警</span>
    </div>
    <div class="input-container postion-center" id="highPriceContainer">
        <span>高于价格</span>
        <input type="text" placeholder="输入价格" id="highPrice">
        <span>预警</span>
    </div>
    <div class="postion-center ram-info">EOS 全网内存统计</div>
    <div class="ram-info-container">
        <div class="left">
            <div class="postion-center">
                总内存 <span class="real-time-normal" id="max-ram"></span> GB
            </div>
            <div class="postion-center">
                已分配 <span class="real-time-normal" id="realtime-ram"></span> GB
            </div>
        </div>
        <div class="right">
            <div class="postion-center">
                占比 <span class="real-time-normal" id="percent-ram"></span> %
            </div>
        </div>
    </div>
    <div class="postion-center eos-info">EOS兑美元价格</div>
    <div class="postion-center" id="eos-price"></div>

    <hr>
    
    
    
    <h2 style="position: relative; text-align: left; padding-left: 15px;"> 
        <span class="refresh">刷新</span>
    </h2>
    
    <div class="bigone">
        <h4>1000EOS以上 成交记录</h4>
        <p class="query-bar"><input id="big-account" type="text" placeholder="account" /> <button id="big-query-btn">查询</button> <button id="big-clear-btn">清空</button>  </p>
        <ul class="big-list">
            
        </ul> 
    </div>
    <div class="trade-history">
        <h4>EOS 内存交易记录</h4>
        <p class="query-bar"><input id="account" type="text" placeholder="account" /> <button id="query-btn">查询</button> <button id="clear-btn">清空</button>  </p>

        <ul class="trade-list">
            
        </ul>
    </div>

    <div class="big-one">
        <h4>持仓大户</h4>
        <div class="bigone-list">

        </div>
    </div>
    


    <div class="clearfix"></div>
    <audio id="player" controls="controls" style="display: none;">
        <source src="alert.mp3"/>
    </audio>
    <script src="lodash.min.js"></script>
    <script src="moment.js"></script>
    <script src="jquery-3.3.1.min.js"></script>
    <script>
        var player = $("#player")[0];

        // eos 价格

        function eosPrice() {
            $.get('https://api.coinmarketcap.com/v2/ticker/1765/').then(function (res) {
                if (res.data) {
                    $('#eos-price').html('1 EOS = <span class="real-time"> $' + res.data.quotes.USD.price.toFixed(2) + '</span> USD')
                }
            });
        }

        //预警声音控制
        function playMusic() {
                player.play(); /*播放*/
        }
        function colorControl() {
            $('#lowPriceContainer').removeClass('alert');
            $('#highPriceContainer').removeClass('alert');
        }

        // ram实时价格 全网内存

        function ramPrice() {
            $.ajax({
                url: 'https://api.eosflare.io/chain/get_info',
                type: 'POST',
                data: JSON.stringify({"_url":"/chain/get_info","_method":"POST","_headers":{"content-type":"application/json"},"lang":"zh-CN"})
            }).then(function (res) {
                if (res.err_code === 0 && res.result) {
                    var realPrice = res.result.ramPrice.toFixed(6);
                    var maxRam = (res.result.ramMax/1024/1024/1024).toFixed(2);
                    var realtimeRam = (res.result.ramReserved /1024/1024/1024).toFixed(2);
                    var percentRam = (realtimeRam/maxRam*100).toFixed(2);
                    $('#real-time-price').html('<i class="real-time">'+realPrice+'</i>');
                    $('#max-ram').text(maxRam);
                    $('#realtime-ram').text(realtimeRam);
                    $('#percent-ram').text(percentRam);

                    var lowPrice = $('#lowPrice').val() == '' ? 0 :parseFloat($('#lowPrice').val()).toFixed(6);
                    var highPrice = $('#highPrice').val() == '' ? 0 :parseFloat($('#highPrice').val()).toFixed(6);

                    colorControl();
//                    console.log(lowPrice,highPrice,1);

                    if(!isNaN(lowPrice) && !isNaN(highPrice) && !(lowPrice == 0 && highPrice == 0)){
//                        console.log(lowPrice,highPrice,2);
                        if(lowPrice !== 0 && highPrice !== 0 && highPrice >lowPrice){
                            if(realPrice >= highPrice){
                                console.log('实际价格高于最高价');
                                colorControl();
                                $('#highPriceContainer').addClass('alert');
                                playMusic();
                            }else if(realPrice <= lowPrice){
                                console.log('实际价格低于最低价');
                                colorControl();
                                $('#lowPriceContainer').addClass('alert');
                                playMusic();
                            }
                        }else if(lowPrice == 0){
                            if(realPrice >= highPrice){
                                console.log('最低价为0 实际价格高于最高价');
                                colorControl();
                                $('#highPriceContainer').addClass('alert');
                                playMusic();
                            }
                        }else{
                            if(realPrice <= lowPrice){
                                console.log('最高价为0 实际价格低于最低价');
                                colorControl();
                                $('#lowPriceContainer').addClass('alert');
                                playMusic();
                            }
                        }

                    }else{
                        player.pause();
                    }
                }
            })
        }
        
        setInterval(eosPrice, 20000);
        setInterval(ramPrice, 2000);

        ramPrice();
        eosPrice();



        // 交易记录

        function getTradList(account) {

            var apiUrl = 'https://preserver.mytokenpocket.vip/v1/eos_transaction_action/last_ram_list?count=30';

            if (account) {
                apiUrl = 'https://preserver.mytokenpocket.vip/v1/eos_transaction_action/ram_list?count=50&account=' + account;
            }

            $.get(apiUrl).then(function (res) {
                if (res.result === 0 && res.data) {


                    if (!res.data.length) {
                        $('.trade-list').html('<li class="empty-li">暂无数据</li>')
                        return;
                    }

                    var ramInfo = _.filter(res.data, function (item) {
                        return _.includes(['buyrambytes', 'buyram', 'sellram'], item.name) && ((item.bytes && +item.bytes > 10240) || !item.bytes);
                    });

                    var tradeHtml = '';

                    _.forEach(ramInfo, function (item) {
                        switch(item.name) {
                            case 'buyrambytes':
                                tradeHtml += '<li> <span class="time">' + moment(item.timestamp*1000).format('MM-DD HH:mm:ss') + '</span><span class="from from-buy" data-from="' + item.from + '">' + item.from + '</span> <span class="buy">买：' + (item.count ? ( parseFloat(item.count).toFixed(2) + ' EOS') : (parseFloat(item.bytes / 1024).toFixed(1) + ' KB')) + '</span></li>';
                                break;
                            case 'buyram':
                                tradeHtml += '<li> <span class="time">' + moment(item.timestamp*1000).format('MM-DD HH:mm:ss') + '</span><span class="from from-buy" data-from="' + item.from + '">' + item.from + '</span> <span class="buy">买：' + (parseFloat(item.quantity).toFixed(2) + ' EOS') + '</span></li>';
                                break;
                            case 'sellram':
                                tradeHtml += '<li> <span class="time">' + moment(item.timestamp*1000).format('MM-DD HH:mm:ss') + '</span><span class="from from-sell" data-from="' + item.from + '">' + item.from + '</span> <span class="sell">卖：' + (item.count ? ( parseFloat(item.count).toFixed(2)  + ' EOS') :  (parseFloat(item.bytes / 1024).toFixed(1) + ' KB')) + '</span></li>';
                                break;
                        }
                    });
                
                    $('.trade-list').html(tradeHtml)
                }
                else {
                }
            });
        }

        function getBigList(account) {
            var apiUrl = 'https://preserver.mytokenpocket.vip/v1/eos_transaction_action/ram_large_list?count=20';

            if (account) {
                apiUrl = 'https://preserver.mytokenpocket.vip/v1/eos_transaction_action/ram_list?count=20&account=' + account;
            }

            $.get(apiUrl).then(function (res) {
                if (res.result === 0 && res.data) {
                    if (!res.data.length) {
                        $('.big-list').html('<li class="empty-li">暂无数据</li>')
                        return;
                    }

                    var ramInfo = _.filter(res.data, function (item) {
                        return _.includes(['buyrambytes', 'buyram', 'sellram'], item.name) && ((item.bytes && +item.bytes > 10240) || !item.bytes);
                    });

                    var tradeHtml = '';

                    _.forEach(ramInfo, function (item) {
                        switch(item.name) {
                            case 'buyrambytes':
                                tradeHtml += '<li> <span class="time">' + moment(item.timestamp*1000).format('MM-DD HH:mm:ss') + '</span><span class="from from-buy" data-from="' + item.from + '">' + item.from + '</span> <span class="buy">买：' + (item.count ? ( parseFloat(item.count).toFixed(2) + ' EOS') : (parseFloat(item.bytes / 1024).toFixed(1) + ' KB')) + '</span></li>';
                                break;
                            case 'buyram':
                                tradeHtml += '<li> <span class="time">' + moment(item.timestamp*1000).format('MM-DD HH:mm:ss') + '</span><span class="from from-buy" data-from="' + item.from + '">' + item.from + '</span> <span class="buy">买：' + (parseFloat(item.quantity).toFixed(2) + ' EOS') + '</span></li>';
                                break;
                            case 'sellram':
                                tradeHtml += '<li> <span class="time">' + moment(item.timestamp*1000).format('MM-DD HH:mm:ss') + '</span><span class="from from-sell" data-from="' + item.from + '">' + item.from + '</span> <span class="sell">卖：' + (item.count ? ( parseFloat(item.count).toFixed(2)  + ' EOS') :  (parseFloat(item.bytes / 1024).toFixed(1) + ' KB')) + '</span></li>';
                                break;
                        }
                    });
                
                    $('.big-list').html(tradeHtml)
                }
                else {
                }
            });
            }

        
        $('.refresh').on('click', function () {
            $('.trade-list').html('');
            $('.big-list').html('');
            $('#account').val('');
            getTradList();
            getBigList();
            getBigOneList();
        })

        $('#clear-btn').on('click', function () {
            $('#account').val('');
            getTradList();
        });

        $('#query-btn').on('click', function () {
            var account = _.trim($('#account').val());
            getTradList(account);
        });

        $('.trade-list').on('click', '.from', function (e) {
            var account = $(e.target).data('from');
            $('#account').val(account);
            getTradList(account);
        });

        // big
        $('#big-clear-btn').on('click', function () {
            $('#big-account').val('');
            getBigList();
        });

        $('#big-query-btn').on('click', function () {
            var account = _.trim($('#big-account').val());
            getBigList(account);
        });

        $('.big-list').on('click', '.from', function (e) {
            var account = $(e.target).data('from');
            $('#big-account').val(account);
            getBigList(account);
        });


        getTradList();

        getBigList();


        // 大户

        function getBigOneList() {
            $.get('https://preserver.mytokenpocket.vip/v1/ram_account/topn30').then(function (res) {
                if (res.result === 0 && res.data) {
                    if (!res.data.length) {
                        // $('.trade-list').html('<li class="empty-li">暂无数据</li>')
                        return;
                    }

                    
                    var bigoneHtml = '';

                    _.forEach(res.data, function (item, index) {
                        var value = parseFloat(item.value / 1024 /1024).toFixed(2);
                        if (value > 1024) {
                            value = parseFloat(value / 1024).toFixed(2) + ' GB';
                        }
                        else {
                            value = value + ' MB';
                        }

                        bigoneHtml += '<li><span class="rank">' + (index + 1) + '</span> <a target="_blank" href="https://dapp.mytokenpocket.vip/eos-record/index.html?account=' + item.account + '" class="big-account"> ' + item.account + '</a> <span class="volume">' + value + '</span> <span class="percent">' + item.percentage + '%</span></li>';
                    });

                    $('.bigone-list').html(bigoneHtml)
                    
                    }
                    else {
                    }
            })
        }

        getBigOneList();

    </script>
</body>
</html>
