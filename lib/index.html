<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>EOS内存价格趋势</title>
    <style>
        i{
            font-style: normal;
        }
        h5 {
            color: #aaa;
        }

        html, body {
            margin: 0;
            padding: 0;
            background-color: #161619;
            color: #EEE;
        }

        html {
            position: relative;
        }
        body{
            padding-top: 60px;
        }
        p {
            font-size: 14px;
            margin: 8px 0;
        }

        h2 {
            text-align: center;
            font-size: 18px;
            margin: 20px 0 0;
        }

        input:checked + label {
            border: 1px solid #eee;
        }


        .progress p {
            padding: 0;
            margin: 0 0 10px;
            -webkit-transition: all 0.2s ease 0s;
            transition: all 0.2s ease 0s;
            position: relative;
            line-height: 1.5;
        }


        #eos-price {
            position: relative;
            font-size: 18px;
            margin-top: 8px;
        }

        #real-time-price {
            font-size: 24px;
        }

        hr {
            margin: 10px auto;
            border: none;
            border-top: 1px solid #666;
        }


        /* .bigone-list {
            max-width: 500px;
        } */

        .big-list li,
        .trade-list li,
        .bigone-list li {
            padding: 0 12px;
            /* border-top: 1px solid #0f1118; */
            color: #999eb1;
            position: relative;
            overflow: hidden;
        }

        .bigone-list li {
            border-top: 1px solid #171923;
            padding: 8px 20px;
            color: #eee;
        }

        .bigone-list li:nth-child(even) {
            background: #2a2b3a
        }


        .real-time-normal {
            color: #f79816;
        }
        .real-time {
            color: #f79816;
            animation: realtime 0.5s ease 0s 1 alternate;
        }


        @keyframes realtime
        {
            /* 0% {text-shadow: 0 0 0 #fff;}
            80% {text-shadow: 1px 1px 10px #fff;}
            100% {text-shadow: 0 0 0 #fff;} */

            0% {color: #fff; text-shadow: 1px 1px 10px #fff;}
            100% {color: #f79816; text-shadow: 0 0 0 #fff;}
        }

        @media screen and (min-width: 1024px) {

            .bigone, 
            .trade-history
            {
                width: 36%;
            }
            .big-one {
                width: 28%;
            }

            .big-list,
            .trade-list,
            .bigone-list {
                font-size: 14px;
            }

            .statics {
                width: 100%;
            }
        }

        @media screen and (max-width: 321px) {
            .bigone, .trade-history {
                padding-left: 0;
            }
            
            .big-list li, .trade-list li {
                padding: 4px;
            }
     

            .from,
            .buy,
            .sell {
                margin-left: 0;
            }
        }
        .postion-center{
            text-align: center;
            font-size: 18px;
        }
        .input-container{
            font-size: 18px;
            margin-top: 4px;
        }
        .ram-info,.eos-info{
            margin-top: 40px;
        }
        .ram-info-container{
            text-align: center;
            padding-top: 8px;
        }
        .ram-info-container>div{
            display: inline-block;
        }
        .ram-info-container .left{
            margin-right: 14px;
        }
        .alert{
            color: #f70606;
            animation: realtime 0.5s ease 0s 1 alternate;
        }
    </style>
</head>
<body>
    <div class="postion-center">
        实时价格 <span id="real-time-price"></span> EOS/KB
    </div>
    <div class="input-container postion-center" id="lowPriceContainer">
        <span>低于价格</span>
        <input type="text" placeholder="输入价格" id="lowPrice">
        <span>预警</span>
    </div>
    <div class="input-container postion-center" id="highPriceContainer">
        <span>高于价格</span>
        <input type="text" placeholder="输入价格" id="highPrice">
        <span>预警</span>
    </div>
    <div class="postion-center ram-info">EOS 全网内存统计</div>
    <div class="ram-info-container">
        <div class="left">
            <div class="postion-center">
                总内存 <span class="real-time-normal" id="max-ram"></span> GB
            </div>
            <div class="postion-center">
                已分配 <span class="real-time-normal" id="realtime-ram"></span> GB
            </div>
        </div>
        <div class="right">
            <div class="postion-center">
                占比 <span class="real-time-normal" id="percent-ram"></span> %
            </div>
        </div>
    </div>
    <div class="postion-center eos-info">EOS兑美元价格</div>
    <div class="postion-center" id="eos-price"></div>

    <audio id="player" controls="controls" style="display: none;">
        <source src="/lib/alert.mp3"/>
    </audio>

    <script src="/lib/lodash.min.js"></script>
    <!--<script src="moment.js"></script>-->
    <script src="/lib/jquery-3.3.1.min.js"></script>
    <script>
        var player = $("#player")[0];

        // eos 价格

        function eosPrice() {
            $.get('https://api.coinmarketcap.com/v2/ticker/1765/').then(function (res) {
                if (res.data) {
                    $('#eos-price').html('1 EOS = <span class="real-time"> $' + res.data.quotes.USD.price.toFixed(2) + '</span> USD')
                }
            });
        }

        //预警声音控制
        function playMusic() {
                player.play(); /*播放*/
        }
        function colorControl() {
            $('#lowPriceContainer').removeClass('alert');
            $('#highPriceContainer').removeClass('alert');
        }

        // ram实时价格 全网内存

        function ramPrice() {
            $.ajax({
                url: 'https://api.eosflare.io/chain/get_info',
                type: 'POST',
                data: JSON.stringify({"_url":"/chain/get_info","_method":"POST","_headers":{"content-type":"application/json"},"lang":"zh-CN"})
            }).then(function (res) {
                if (res.err_code === 0 && res.result) {
                    var realPrice = res.result.ramPrice.toFixed(6);
                    var maxRam = (res.result.ramMax/1024/1024/1024).toFixed(2);
                    var realtimeRam = (res.result.ramReserved /1024/1024/1024).toFixed(2);
                    var percentRam = (realtimeRam/maxRam*100).toFixed(2);
                    $('#real-time-price').html('<i class="real-time">'+realPrice+'</i>');
                    $('#max-ram').text(maxRam);
                    $('#realtime-ram').text(realtimeRam);
                    $('#percent-ram').text(percentRam);

                    var lowPrice = $('#lowPrice').val() == '' ? 0 :parseFloat($('#lowPrice').val()).toFixed(6);
                    var highPrice = $('#highPrice').val() == '' ? 0 :parseFloat($('#highPrice').val()).toFixed(6);

                    colorControl();
//                    console.log(lowPrice,highPrice,1);

                    if(!isNaN(lowPrice) && !isNaN(highPrice) && !(lowPrice == 0 && highPrice == 0)){
//                        console.log(lowPrice,highPrice,2);
                        if(lowPrice !== 0 && highPrice !== 0 && highPrice >lowPrice){
                            if(realPrice >= highPrice){
                                console.log('实际价格高于最高价');
                                colorControl();
                                $('#highPriceContainer').addClass('alert');
                                playMusic();
                            }else if(realPrice <= lowPrice){
                                console.log('实际价格低于最低价');
                                colorControl();
                                $('#lowPriceContainer').addClass('alert');
                                playMusic();
                            }
                        }else if(lowPrice == 0){
                            if(realPrice >= highPrice){
                                console.log('最低价为0 实际价格高于最高价');
                                colorControl();
                                $('#highPriceContainer').addClass('alert');
                                playMusic();
                            }
                        }else{
                            if(realPrice <= lowPrice){
                                console.log('最高价为0 实际价格低于最低价');
                                colorControl();
                                $('#lowPriceContainer').addClass('alert');
                                playMusic();
                            }
                        }

                    }else{
                        player.pause();
                    }
                }
            })
        }
        
        setInterval(eosPrice, 20000);
        setInterval(ramPrice, 2000);

        ramPrice();
        eosPrice();

    </script>
</body>
</html>
